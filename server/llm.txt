===CODE-20251108-server===
//src/app.ts
importexpress,{Express,Request,Response,RequestHandler}from'express';import{initTspecServer,TspecDocsMiddleware}from'tspec';import{errorHandler,notFoundHandler}from'./middlewares/error.middleware';importrouterfrom'./modules/index';import{corsMiddleware}from'./middlewares/cors.middleware';importhelmetfrom'helmet';importmorganfrom'morgan';importtspecOptionsfrom'./tspec.config';constapp:Express=express();app.use(corsMiddleware());app.use(helmet());app.use(express.json({limit:'10mb'}));app.use(morgan('combined'));app.use(express.urlencoded({extended:true}));app.get('/health',(req:Request,res:Response)=>{res.status(200).json({success:true,message:'NationalToiletCampaignAPIisrunning',timestamp:newDate().toISOString(),version:'1.0.0',environment:process.env.NODE_ENV||'development',});});asyncfunctionsetupTspecDocs(){consttspecMiddlewares=awaitTspecDocsMiddleware(tspecOptions);app.use('/api-docs',...(tspecMiddlewaresasunknownasRequestHandler[]));}app.get('/',(req:Request,res:Response)=>{res.redirect('/api-docs');});app.use('/api/v1',router);app.use(notFoundHandler);app.use(errorHandler);exportdefaultapp;
//src/config.ts
import{z}from'zod';importdotenvfrom'dotenv';dotenv.config();exportconstenvSchema=z.object({PORT:z.number().default(3000),MODE:z.enum(['development','production','test']).default('development'),DATABASE_URL:z.string({required_error:'DATABASE_URLisrequiredintheenvironmentvariables',}),});exportconstenvConfig=envSchema.parse({PORT:Number(process.env.PORT),MODE:process.env.NODE_ENV||'development',DATABASE_URL:process.env.DATABASE_URL,});exportconstappConfig={allowedOrigins:['http:};
//src/middlewares/auth.middleware.ts
import{Request,Response,NextFunction}from'express';importAuthServicefrom'../services/auth.service';import{logger}from'../utils/logger.utils';declareglobal{namespaceExpress{interfaceRequest{admin?:{id:string;email:string;name:string;role:'SYSTEM_ADMIN'|'ADMIN';status:string;};}}}exportconstauthenticateAdmin=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{consttoken=AuthService.extractTokenFromHeader(req.headers.authorization);if(!token){res.status(401).json({success:false,message:'Accessdenied.Novalidtokenprovided.',});return;}constvalidation=awaitAuthService.validateSession(token);if(!validation.valid||!validation.admin){res.status(401).json({success:false,message:validation.message||'Invalidorexpiredsessiontoken.',});return;}req.admin={id:validation.admin.id,email:validation.admin.email,name:validation.admin.name,role:validation.admin.roleas'SYSTEM_ADMIN'|'ADMIN',status:validation.admin.status,};next();}catch(error){logger.error('Authenticationerror:',error);res.status(500).json({success:false,message:'Authenticationfailed.',});}};exportconstrequireSystemAdmin=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{awaitauthenticateAdmin(req,res,()=>{});if(res.headersSent){return;}if(!req.admin||!AuthService.isSystemAdmin(req.admin)){res.status(403).json({success:false,message:'Accessdenied.Systemadminprivilegesrequired.',});return;}next();}catch(error){logger.error('Systemadminauthenticationerror:',error);res.status(500).json({success:false,message:'Authenticationfailed.',});}};exportconstoptionalAuth=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{consttoken=AuthService.extractTokenFromHeader(req.headers.authorization);if(token){constvalidation=awaitAuthService.validateSession(token);if(validation.valid&&validation.admin){req.admin={id:validation.admin.id,email:validation.admin.email,name:validation.admin.name,role:validation.admin.roleas'SYSTEM_ADMIN'|'ADMIN',status:validation.admin.status,};}}next();}catch(error){logger.warn('Optionalauthenticationwarning:',error);next();}};exportconstcheckSetupComplete=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{if(req.path==='/setup/first-admin'){next();return;}const{prisma}=require('../../utils/prisma.utils');constadminCount=awaitprisma.admin.count({where:{role:'SYSTEM_ADMIN',status:'ACTIVE'},});if(adminCount===0){res.status(503).json({success:false,message:'Systemsetupincomplete.Pleasecompleteinitialsetup.',setupRequired:true,setupUrl:AuthService.generateSetupUrl(),});return;}next();}catch(error){logger.error('Setupcheckerror:',error);next();}};exportconstrequireRole=(role:'SYSTEM_ADMIN'|'ADMIN')=>{returnasync(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{awaitauthenticateAdmin(req,res,()=>{});if(res.headersSent){return;}if(!req.admin||!AuthService.hasRole(req.admin,role)){res.status(403).json({success:false,message:`Accessdenied.${role}rolerequired.`,});return;}next();}catch(error){logger.error('Rolecheckerror:',error);res.status(500).json({success:false,message:'Authorizationfailed.',});}};};
//src/middlewares/cors.middleware.ts
importcorsfrom'cors';exportconstcorsMiddleware=()=>cors({origin:'*',credentials:true,});
//src/middlewares/error.middleware.ts
import{NextFunction,Request,Response}from'express';import{envConfig}from'../config';import{ErrorRequestHandler}from'express';importchalkfrom'chalk';import{z}from'zod';exportclassApiErrorextendsError{statusCode:number;isOperational:boolean;constructor(statusCode:number,message:string,isOperational=true){super(message);this.statusCode=statusCode;this.isOperational=isOperational;Error.captureStackTrace(this,this.constructor);}}exportconstnotFoundHandler=(req:Request,res:Response,next:NextFunction)=>{consterror=newApiError(404,`Routenotfound:${req.method}${req.originalUrl}`);next(error);};exportconsttemporarilyDisabled=(req:Request,res:Response,next:NextFunction)=>{consterror=newApiError(503,`Thisendpointistemporarilydisabled`);next(error);};exportconsterrorHandler:ErrorRequestHandler=(err:any,req:Request,res:Response,next:NextFunction):void=>{if(errinstanceofz.ZodError||err.name==='ZodError'){res.status(400).json({success:false,message:'Validationfailed',errors:err.errors||err.issues,});return;}if(err.name==='JsonWebTokenError'){res.status(401).json({success:false,message:'Invalidorexpiredtoken',});return;}if(err.name==='TokenExpiredError'){res.status(401).json({success:false,message:'Tokenhasexpired',});return;}if(err.code&&err.code.startsWith('P')){letmessage='Databaseoperationfailed';switch(err.code){case'P2002':message='Recordalreadyexists(uniqueconstraintviolation)';break;case'P2025':message='Recordnotfound';break;case'P2003':message='Foreignkeyconstraintviolation';break;}res.status(400).json({success:false,message,...(process.env.NODE_ENV==='development'&&{error:err.message}),});return;}if(errinstanceofApiError){res.status(err.statusCode).json({success:false,message:err.message,});return;}if(errinstanceofSyntaxError&&'body'inerr){res.status(400).json({success:false,message:'InvalidJSONformat',});return;}constchalkColor={error:chalk.red,success:chalk.green,getReq:chalk.magenta,postReq:chalk.cyan,};const{hostname,originalUrl,protocol,method}=req;chalkColor.error('âŒERROR'),`${method==='GET'?chalkColor.getReq(method):chalkColor.postReq(method)}${protocol}:);conststatusCode=err.statusCode||err.status||500;constmessage=process.env.NODE_ENV==='production'?'Internalservererror':err.message||'Somethingwentwrong!';res.status(statusCode).json({success:false,message,...(process.env.NODE_ENV==='development'&&{stack:err.stack,error:err,}),});};exportconstnotFoundError=(resource:string)=>{returnnewApiError(404,`${resource}notfound`);};exportconstbadRequestError=(message:string)=>{returnnewApiError(400,message);};exportconstunauthorizedError=(message='Unauthorizedaccess')=>{returnnewApiError(401,message);};exportconstforbiddenError=(message='Accessforbidden')=>{returnnewApiError(403,message);};exportconstconflictError=(message:string)=>{returnnewApiError(409,message);};exportconstvalidationError=(message:string)=>{returnnewApiError(422,message);};
//src/modules/admin/admin.controller.ts
import{Request,Response,NextFunction}from'express';import{inviteAdminSchema,acceptInviteSchema,updateAdminSchema,getAdminSchema,filterAdminsSchema,setupFirstAdminSchema,}from'./admin.schema';import{createFirstSystemAdminRepository,inviteAdminRepository,getAdminByInviteTokenRepository,activateAdminRepository,getAdminByGoogleIdRepository,getPaginatedAdminsRepository,updateAdminRepository,deleteAdminRepository,getAdminStatsRepository,getAdminByIdRepository,}from'./admin.utils';importAuthServicefrom'../../services/auth.service';import{logger}from'../../utils/logger.utils';import{SendMail}from'../../utils/mail.util';/***Setupfirstsystemadmin(onlyworksifnosystemadminexists)*/exportconstsetupFirstAdmin=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{constvalidatedData=setupFirstAdminSchema.parse(req.body);constexpectedSetupKey=process.env.FIRST_ADMIN_SETUP_KEY;if(!expectedSetupKey||validatedData.setupKey!==expectedSetupKey){res.status(401).json({success:false,message:'Invalidsetupkey',});return;}constgoogleCredentials=awaitAuthService.verifyGoogleToken(validatedData.googleId);awaitcreateFirstSystemAdminRepository({...validatedData,googleId:googleCredentials.googleId,email:googleCredentials.email,name:validatedData.name||googleCredentials.name,profilePicture:googleCredentials.profilePicture,});constloginResult=awaitAuthService.authenticateWithGoogle(googleCredentials,req.headers['user-agent'],req.ip);if(!loginResult.success){res.status(500).json({success:false,message:'Failedtocreateadminsession',});return;}res.status(201).json({success:true,message:'Firstsystemadmincreatedsuccessfully',data:{admin:loginResult.admin,token:loginResult.token,},});}catch(error){next(error);}};/***Invitenewadmin(SystemAdminonly)*/exportconstinviteAdmin=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{constvalidatedData=inviteAdminSchema.parse(req.body);constinvitedBy=req.admin!.id;if(req.admin!.role!=='SYSTEM_ADMIN'&&validatedData.role==='SYSTEM_ADMIN'){res.status(403).json({success:false,message:'Onlysystemadminscaninviteothersystemadmins',});return;}constnewAdmin=awaitinviteAdminRepository(validatedData,invitedBy);constinviteLink=AuthService.generateInviteUrl(newAdmin.inviteToken!);SendMail({to:newAdmin.email,subject:'AdminInvitation-NationalToiletCampaign',html:`<h2>You'vebeeninvitedtojoinasanadmin</h2><p>Dear${newAdmin.name},</p><p>Youhavebeeninvitedby${req.admin!.name}tojointheNationalToiletCampaignadminpanelasa<strong>${newAdmin.role}</strong>.</p><p>Clickthelinkbelowtoacceptyourinvitation:</p><p><ahref="${inviteLink}"style="background-color:#007bff;color:white;padding:10px20px;text-decoration:none;border-radius:4px;">AcceptInvitation</a></p><p>Thisinvitationwillexpirein7days.</p><p>Ifyoudidn'texpectthisinvitation,youcansafelyignorethisemail.</p>`,});res.status(201).json({success:true,message:'Admininvitationsentsuccessfully',data:{id:newAdmin.id,email:newAdmin.email,name:newAdmin.name,role:newAdmin.role,status:newAdmin.status,inviteUrl:inviteLink,},});}catch(error){next(error);}};/***Acceptinvitationandactivateadminaccount*/exportconstacceptInvite=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{constvalidatedData=acceptInviteSchema.parse(req.body);constpendingAdmin=awaitgetAdminByInviteTokenRepository(validatedData.inviteToken);if(!pendingAdmin){res.status(400).json({success:false,message:'Invalidorexpiredinvitationtoken',});return;}constgoogleCredentials=awaitAuthService.verifyGoogleToken(validatedData.googleId);constexistingAdmin=awaitgetAdminByGoogleIdRepository(googleCredentials.googleId);if(existingAdmin){res.status(400).json({success:false,message:'ThisGoogleaccountisalreadyassociatedwithanotheradmin',});return;}awaitactivateAdminRepository(validatedData.inviteToken,{googleId:googleCredentials.googleId,email:pendingAdmin.email,name:pendingAdmin.name,profilePicture:googleCredentials.profilePicture,});constloginResult=awaitAuthService.authenticateWithGoogle(googleCredentials,req.headers['user-agent'],req.ip);if(!loginResult.success){res.status(500).json({success:false,message:'Failedtocreateadminsession',});return;}res.status(200).json({success:true,message:'Invitationacceptedsuccessfully',data:{admin:loginResult.admin,token:loginResult.token,},});}catch(error){next(error);}};/***GoogleOAuthlogin*/exportconstgoogleLogin=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{const{googleToken}=req.body;if(!googleToken){res.status(400).json({success:false,message:'Googletokenisrequired',});return;}constgoogleCredentials=awaitAuthService.verifyGoogleToken(googleToken);constloginResult=awaitAuthService.authenticateWithGoogle(googleCredentials,req.headers['user-agent'],req.ip);if(!loginResult.success){res.status(401).json({success:false,message:loginResult.message,});return;}res.status(200).json({success:true,message:'Loginsuccessful',data:{admin:loginResult.admin,token:loginResult.token,},});}catch(error){next(error);}};/***Logoutadmin*/exportconstlogout=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{consttoken=AuthService.extractTokenFromHeader(req.headers.authorization);if(token){constlogoutSuccess=awaitAuthService.logout(token);if(!logoutSuccess){logger.warn('Failedtoinvalidatesessionduringlogout');}}res.status(200).json({success:true,message:'Loggedoutsuccessfully',});}catch(error){next(error);}};/***Getalladmins(SystemAdminonly)*/exportconstgetAllAdmins=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{constfilter=filterAdminsSchema.parse({page:req.query.page?parseInt(req.query.pageasstring):1,limit:req.query.limit?parseInt(req.query.limitasstring):10,role:req.query.role,status:req.query.status,search:req.query.search,});constpaginatedData=awaitgetPaginatedAdminsRepository(filter);res.status(200).json({success:true,message:'Adminsretrievedsuccessfully',data:paginatedData,});}catch(error){next(error);}};/***Updateadmin(SystemAdminonly)*/exportconstupdateAdmin=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{const{id}=getAdminSchema.parse(req.params);constupdateData=updateAdminSchema.parse({id,...req.body});constexistingAdmin=awaitgetAdminByIdRepository(id);if(!existingAdmin){res.status(404).json({success:false,message:'Adminnotfound',});return;}if(id===req.admin!.id&&updateData.role){res.status(400).json({success:false,message:'Cannotupdateyourownrole',});return;}constupdatedAdmin=awaitupdateAdminRepository(updateData);res.status(200).json({success:true,message:'Adminupdatedsuccessfully',data:{id:updatedAdmin.id,email:updatedAdmin.email,name:updatedAdmin.name,role:updatedAdmin.role,status:updatedAdmin.status,},});}catch(error){next(error);}};/***Deleteadmin(SystemAdminonly)*/exportconstdeleteAdmin=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{const{id}=getAdminSchema.parse(req.params);if(id===req.admin!.id){res.status(400).json({success:false,message:'Cannotdeleteyourownaccount',});return;}constexistingAdmin=awaitgetAdminByIdRepository(id);if(!existingAdmin){res.status(404).json({success:false,message:'Adminnotfound',});return;}awaitdeleteAdminRepository(id);res.status(200).json({success:true,message:'Admindeletedsuccessfully',});}catch(error){next(error);}};/***Getadminstatistics*/exportconstgetAdminStats=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{conststats=awaitgetAdminStatsRepository();res.status(200).json({success:true,message:'Adminstatisticsretrievedsuccessfully',data:stats,});}catch(error){next(error);}};/***Getcurrentadminprofile*/exportconstgetProfile=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{constadmin=awaitgetAdminByIdRepository(req.admin!.id);if(!admin){res.status(404).json({success:false,message:'Adminprofilenotfound',});return;}res.status(200).json({success:true,message:'Profileretrievedsuccessfully',data:{id:admin.id,email:admin.email,name:admin.name,role:admin.role,profilePicture:admin.profilePicture,lastLoginAt:admin.lastLoginAt,createdAt:admin.createdAt,},});}catch(error){next(error);}};
//src/modules/admin/admin.route.ts
import{Router}from'express';import{setupFirstAdmin,inviteAdmin,acceptInvite,googleLogin,logout,getAllAdmins,updateAdmin,deleteAdmin,getAdminStats,getProfile,}from'./admin.controller';import{authenticateAdmin,requireSystemAdmin,}from'../../middlewares/auth.middleware';constadminRouter=Router();adminRouter.post('/setup/first-admin',setupFirstAdmin);adminRouter.post('/accept-invite',acceptInvite);adminRouter.post('/login/google',googleLogin);adminRouter.post('/logout',authenticateAdmin,logout);adminRouter.get('/profile',authenticateAdmin,getProfile);adminRouter.get('/stats',authenticateAdmin,getAdminStats);adminRouter.post('/invite',requireSystemAdmin,inviteAdmin);adminRouter.get('/',requireSystemAdmin,getAllAdmins);adminRouter.patch('/:id',requireSystemAdmin,updateAdmin);adminRouter.delete('/:id',requireSystemAdmin,deleteAdmin);exportdefaultadminRouter;
//src/modules/admin/admin.schema.ts
import{z}from'zod';exportconstAdminRoleEnum=z.enum(['SYSTEM_ADMIN','ADMIN']);exportconstAdminStatusEnum=z.enum(['PENDING','ACTIVE','SUSPENDED','DEACTIVATED',]);exportconstinviteAdminSchema=z.object({email:z.string().email('Invalidemailaddress'),name:z.string().min(2,'Nameisrequired'),role:AdminRoleEnum.default('ADMIN'),});exportconstacceptInviteSchema=z.object({inviteToken:z.string().min(1,'Invitetokenisrequired'),googleId:z.string().min(1,'GoogleIDtokenisrequired'),});exportconstgoogleLoginSchema=z.object({googleToken:z.string().min(1,'Googletokenisrequired'),});exportconstupdateAdminSchema=z.object({id:z.string(),name:z.string().min(2).optional(),role:AdminRoleEnum.optional(),status:AdminStatusEnum.optional(),isActive:z.boolean().optional(),});exportconstfilterAdminsSchema=z.object({page:z.number().int().positive().default(1),limit:z.number().int().positive().max(100).default(10),role:AdminRoleEnum.optional(),status:AdminStatusEnum.optional(),search:z.string().optional(),});exportconstgetAdminSchema=z.object({id:z.string(),});exportconstrevokeInviteSchema=z.object({id:z.string(),});exportconstsetupFirstAdminSchema=z.object({email:z.string().email('Invalidemailaddress').optional(),name:z.string().min(2,'Nameisrequired').optional(),googleId:z.string().min(1,'GoogleIDtokenisrequired'),setupKey:z.string().min(1,'Setupkeyisrequired'),});exporttypeAdminRole=z.infer<typeofAdminRoleEnum>;exporttypeAdminStatus=z.infer<typeofAdminStatusEnum>;exporttypeInviteAdmin=z.infer<typeofinviteAdminSchema>;exporttypeAcceptInvite=z.infer<typeofacceptInviteSchema>;exporttypeGoogleLogin=z.infer<typeofgoogleLoginSchema>;exporttypeUpdateAdmin=z.infer<typeofupdateAdminSchema>;exporttypeFilterAdmins=z.infer<typeoffilterAdminsSchema>;exporttypeSetupFirstAdmin=z.infer<typeofsetupFirstAdminSchema>;
//src/modules/admin/admin.tspec.ts
import{Tspec}from'tspec';/**@tspec-descriptionAdminuseraccount*/exportinterfaceAdmin{/**Uniqueidentifierfortheadmin*/id:string;/**Adminemailaddress*/email:string;/**Adminfullname*/name:string;/**ProfilepictureURLfromGoogle*/profilePicture?:string;/**GoogleaccountID*/googleId?:string;/**Adminrolelevel*/role:'SYSTEM_ADMIN'|'ADMIN';/**Adminaccountstatus*/status:'PENDING'|'ACTIVE'|'SUSPENDED'|'DEACTIVATED';/**Lastlogintimestamp*/lastLoginAt?:string;/**Whetheradminaccountisactive*/isActive:boolean;/**IDofadminwhosenttheinvitation*/invitedBy?:string;/**IDofadminwhocreatedthisadmin*/createdBy?:string;/**Accountcreationtimestamp*/createdAt:string;/**Accountupdatetimestamp*/updatedAt:string;}/**@tspec-descriptionRequesttoinviteanewadmin*/exportinterfaceInviteAdminRequest{/**Emailaddressoftheadmintoinvite*/email:string;/**Fullnameoftheadmintoinvite*/name:string;/**Roletoassigntothenewadmin*/role?:'SYSTEM_ADMIN'|'ADMIN';}/**@tspec-descriptionGoogleOAuthloginrequest*/exportinterfaceGoogleLoginRequest{/**GoogleIDtokenfromOAuth*/googleToken:string;}/**@tspec-descriptionSetupfirstsystemadminrequest*/exportinterfaceSetupFirstAdminRequest{/**Emailaddress(optional,willuseGoogleemail)*/email?:string;/**Name(optional,willuseGooglename)*/name?:string;/**GoogleIDtokenfromOAuth*/googleId:string;/**Secretsetupkeyfromenvironmentvariables*/setupKey:string;}/**@tspec-descriptionAuthenticationresponse*/exportinterfaceAuthResponse{success:boolean;message:string;data:{admin:{id:string;email:string;name:string;role:string;profilePicture?:string;};/**Sessiontokenforauthentication*/token:string;};}/**@tspec-descriptionStandardsuccessresponse*/exportinterfaceSuccessResponse<T=any>{success:true;message:string;data?:T;}/**@tspec-descriptionStandarderrorresponse*/exportinterfaceErrorResponse{success:false;message:string;errors?:any[];}exporttypeAdminApiSpec=Tspec.DefineApiSpec<{tags:['Admin'];security:'bearerAuth';paths:{/**Setupfirstsystemadmin*/'/api/v1/admin/setup/first-admin':{post:{summary:'Setupfirstsystemadmin';description:'Createsthefirstsystemadminaccount(onlyworksifnosystemadminexists)';body:SetupFirstAdminRequest;responses:{/**Firstsystemadmincreatedsuccessfully*/201:AuthResponse;/**Invalidsetupkey*/401:ErrorResponse;/**Systemadminalreadyexistsorinvaliddata*/400:ErrorResponse;};};};/**GoogleOAuthlogin*/'/api/v1/admin/login/google':{post:{summary:'GoogleOAuthlogin';description:'AuthenticateadminusingGoogleOAuthtoken';body:GoogleLoginRequest;responses:{/**Loginsuccessful*/200:AuthResponse;/**InvalidGoogletoken*/400:ErrorResponse;/**NoadminaccountfoundforthisGoogleaccountoraccountnotactive*/401:ErrorResponse;};};};/**Getcurrentadminprofile*/'/api/v1/admin/profile':{get:{summary:'Getcurrentadminprofile';description:"Gettheauthenticatedadmin'sprofileinformation";responses:{/**Profileretrievedsuccessfully*/200:SuccessResponse<{id:string;email:string;name:string;role:string;profilePicture?:string;lastLoginAt?:string;createdAt:string;}>;/**Unauthorized*/401:ErrorResponse;/**Adminprofilenotfound*/404:ErrorResponse;};};};/**Invitenewadmin*/'/api/v1/admin/invite':{post:{summary:'Invitenewadmin(SystemAdminonly)';description:'Sendinvitationtoanewadminviaemail';body:InviteAdminRequest;responses:{/**Admininvitationsentsuccessfully*/201:SuccessResponse<{id:string;email:string;name:string;role:string;status:string;inviteUrl:string;}>;/**Emailalreadyexistsorinvaliddata*/400:ErrorResponse;/**Unauthorized*/401:ErrorResponse;/**Systemadminprivilegesrequired*/403:ErrorResponse;};};};/**Getalladmins*/'/api/admin':{get:{summary:'Getalladmins(SystemAdminonly)';description:'Retrievealladminswithfilteringandpagination';query:{/**Pagenumber*/page?:number;/**Numberofitemsperpage*/limit?:number;/**Filterbyrole*/role?:'SYSTEM_ADMIN'|'ADMIN';/**Filterbystatus*/status?:'PENDING'|'ACTIVE'|'SUSPENDED'|'DEACTIVATED';/**Searchbynameoremail*/search?:string;};responses:{/**Adminsretrievedsuccessfully*/200:SuccessResponse<{admins:Admin[];total:number;page:number;limit:number;totalPages:number;}>;/**Unauthorized*/401:ErrorResponse;/**Systemadminprivilegesrequired*/403:ErrorResponse;};};};/**Updateadmin*/'/api/v1/admin/:id':{patch:{summary:'Updateadmin(SystemAdminonly)';description:'Updateadmindetailsandpermissions';path:{/**AdminID*/id:string;};body:{/**Updatedname*/name?:string;/**Updatedrole*/role?:'SYSTEM_ADMIN'|'ADMIN';/**Updatedstatus*/status?:'PENDING'|'ACTIVE'|'SUSPENDED'|'DEACTIVATED';/**Whetheradminisactive*/isActive?:boolean;};responses:{/**Adminupdatedsuccessfully*/200:SuccessResponse<{id:string;email:string;name:string;role:string;status:string;}>;/**Cannotupdateyourownroleorinvaliddata*/400:ErrorResponse;/**Unauthorized*/401:ErrorResponse;/**Systemadminprivilegesrequired*/403:ErrorResponse;/**Adminnotfound*/404:ErrorResponse;};};delete:{summary:'Deleteadmin(SystemAdminonly)';description:'Deleteanadminaccount';path:{/**AdminID*/id:string;};responses:{/**Admindeletedsuccessfully*/200:SuccessResponse;/**Cannotdeleteyourownaccount*/400:ErrorResponse;/**Unauthorized*/401:ErrorResponse;/**Systemadminprivilegesrequired*/403:ErrorResponse;/**Adminnotfound*/404:ErrorResponse;};};};};}>;
//src/modules/admin/admin.utils.ts
import{prisma}from'../../utils/prisma.utils';import{InviteAdmin,UpdateAdmin,FilterAdmins}from'./admin.schema';importcryptofrom'crypto';exportinterfaceGoogleCredentials{googleId:string;email:string;name:string;profilePicture?:string;emailVerified?:boolean;}interfaceFirstAdminData{email:string;name:string;googleId:string;profilePicture?:string;}exportasyncfunctioncreateFirstSystemAdminRepository(data:FirstAdminData){constexistingSystemAdmin=awaitprisma.admin.findFirst({where:{role:'SYSTEM_ADMIN'},});if(existingSystemAdmin){thrownewError('Systemadminalreadyexists');}returnawaitprisma.admin.create({data:{email:data.email,name:data.name,googleId:data.googleId,profilePicture:data.profilePicture,role:'SYSTEM_ADMIN',status:'ACTIVE',lastLoginAt:newDate(),},});}exportasyncfunctioninviteAdminRepository(data:InviteAdmin,invitedBy:string){constexistingAdmin=awaitprisma.admin.findUnique({where:{email:data.email},});if(existingAdmin){thrownewError('Adminwiththisemailalreadyexists');}constinviteToken=crypto.randomBytes(32).toString('hex');constinviteExpiry=newDate(Date.now()+7*24*60*60*1000);returnawaitprisma.admin.create({data:{email:data.email,name:data.name,role:data.role,status:'PENDING',invitedBy,createdBy:invitedBy,inviteToken,inviteExpiry,},});}exportasyncfunctiongetAdminByInviteTokenRepository(inviteToken:string){returnawaitprisma.admin.findUnique({where:{inviteToken,inviteExpiry:{gte:newDate(),},},});}exportasyncfunctionactivateAdminRepository(inviteToken:string,googleData:GoogleCredentials){returnawaitprisma.admin.update({where:{inviteToken},data:{googleId:googleData.googleId,profilePicture:googleData.profilePicture,status:'ACTIVE',inviteToken:null,inviteExpiry:null,lastLoginAt:newDate(),},});}exportasyncfunctiongetAdminByGoogleIdRepository(googleId:string){returnawaitprisma.admin.findUnique({where:{googleId},});}exportasyncfunctiongetAdminByEmailRepository(email:string){returnawaitprisma.admin.findUnique({where:{email},});}exportasyncfunctiongetAdminByIdRepository(id:string){returnawaitprisma.admin.findUnique({where:{id},});}exportasyncfunctionupdateAdminRepository(data:UpdateAdmin){const{id,...updateData}=data;returnawaitprisma.admin.update({where:{id},data:updateData,});}exportasyncfunctionupdateAdminLoginRepository(googleId:string){returnawaitprisma.admin.update({where:{googleId},data:{lastLoginAt:newDate(),},});}exportasyncfunctiongetPaginatedAdminsRepository(filters:FilterAdmins){const{page,limit,role,status,search}=filters;constwhereClause:any={};if(role)whereClause.role=role;if(status)whereClause.status=status;if(search){whereClause.OR=[{name:{contains:search,mode:'insensitive'}},{email:{contains:search,mode:'insensitive'}},];}consttotal=awaitprisma.admin.count({where:whereClause});constskip=(page-1)*limit;consttotalPages=Math.ceil(total/limit);constadmins=awaitprisma.admin.findMany({where:whereClause,skip,take:limit,orderBy:{createdAt:'desc'},select:{id:true,email:true,name:true,profilePicture:true,role:true,status:true,lastLoginAt:true,createdAt:true,invitedBy:true,createdBy:true,},});return{admins,total,page,limit,totalPages,};}exportasyncfunctiondeleteAdminRepository(id:string){returnawaitprisma.admin.delete({where:{id},});}exportasyncfunctionrevokeInviteRepository(id:string){returnawaitprisma.admin.update({where:{id},data:{inviteToken:null,inviteExpiry:null,status:'DEACTIVATED',},});}exportasyncfunctioncreateAdminSessionRepository(adminId:string,userAgent?:string,ipAddress?:string){consttoken=crypto.randomBytes(64).toString('hex');constexpiresAt=newDate(Date.now()+30*24*60*60*1000);returnawaitprisma.adminSession.create({data:{adminId,token,expiresAt,userAgent,ipAddress,},});}exportasyncfunctiongetAdminSessionRepository(token:string){try{constsession=awaitprisma.adminSession.findUnique({where:{token},include:{admin:true,},});if(!session||session.expiresAt<newDate()){returnnull;}if(!session.admin||session.admin.status!=='ACTIVE'||!session.admin.isActive){returnnull;}returnsession;}catch(error){returnnull;}}exportasyncfunctiondeleteAdminSessionRepository(token:string){try{returnawaitprisma.adminSession.delete({where:{token},});}catch(error){returnnull;}}exportasyncfunctiondeleteExpiredSessionsRepository(){returnawaitprisma.adminSession.deleteMany({where:{expiresAt:{lt:newDate(),},},});}exportasyncfunctioncleanupExpiredSessionsRepository(){constdeletedSessions=awaitdeleteExpiredSessionsRepository();returndeletedSessions;}exportasyncfunctiongetAdminStatsRepository(){consttotalAdmins=awaitprisma.admin.count();constactiveAdmins=awaitprisma.admin.count({where:{status:'ACTIVE'},});constpendingInvites=awaitprisma.admin.count({where:{status:'PENDING'},});constsystemAdmins=awaitprisma.admin.count({where:{role:'SYSTEM_ADMIN'},});constrecentLogins=awaitprisma.admin.findMany({where:{status:'ACTIVE',lastLoginAt:{not:null},},orderBy:{lastLoginAt:'desc'},take:5,select:{id:true,name:true,email:true,lastLoginAt:true,},});return{totalAdmins,activeAdmins,pendingInvites,systemAdmins,recentLogins,};}exportasyncfunctionhasSystemAdminRepository():Promise<boolean>{constcount=awaitprisma.admin.count({where:{role:'SYSTEM_ADMIN',status:'ACTIVE',},});returncount>0;}exportasyncfunctiongetAdminActiveSessionsRepository(adminId:string){returnawaitprisma.adminSession.findMany({where:{adminId,expiresAt:{gte:newDate(),},},select:{id:true,token:true,createdAt:true,expiresAt:true,userAgent:true,ipAddress:true,},orderBy:{createdAt:'desc'},});}exportasyncfunctionrevokeAllAdminSessionsRepository(adminId:string){returnawaitprisma.adminSession.deleteMany({where:{adminId},});}
//src/modules/index.ts
import{Router}from'express';importadminRouterfrom'./admin/admin.route';importreportRouterfrom'./report/report.route';importuploadRouterfrom'./upload/upload.route';constrouter=Router();router.use('/upload',uploadRouter);router.use('/admin',adminRouter);router.use('/report',reportRouter);exportdefaultrouter;
//src/modules/report/report.controller.ts
import{Request,Response,NextFunction}from'express';import{createReportSchema,getReportSchema,filterReportsSchema,updateReportStatusSchema,getReportsByLocationSchema,}from'./report.schema';import{createReportRepository,deleteReportRepository,getReportByIdRepository,getPaginatedReportsRepository,updateReportStatusRepository,getReportsByLocationRepository,getReportStatsRepository,getRecentReportsRepository,}from'./report.utils';import{SendMail}from'../../utils/mail.util';import{logger}from'../../utils/logger.utils';/***Createanewtoiletreportsubmission*/exportconstcreateReport=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{constvalidatedData=createReportSchema.parse(req.body);constnewReport=awaitcreateReportRepository(validatedData);if(newReport.submitterEmail){awaitSendMail({to:newReport.submitterEmail,subject:'ToiletReportSubmissionReceived-NationalToiletCampaign',html:`<h2>Thankyouforyoursubmission!</h2><p>Dear${newReport.submitterName},</p><p>Wehavereceivedyourtoiletreportfor<strong>${newReport.lga},${newReport.state}</strong>.</p><p>YourreportIDis:<strong>${newReport.id}</strong></p><p>Ourteamwillreviewyoursubmissionandupdatethestatusaccordingly.</p><p>ThankyouforcontributingtobettersanitationinNigeria!</p>`,});}res.status(201).json({success:true,message:'Toiletreportsubmittedsuccessfully',data:newReport,});}catch(error){next(error);}};/***GetaspecificreportbyID*/exportconstgetReport=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{const{id}=getReportSchema.parse(req.params);constreport=awaitgetReportByIdRepository(id);if(!report){res.status(404).json({success:false,message:'Reportnotfound',});return;}res.status(200).json({success:true,message:'Reportretrievedsuccessfully',data:report,});}catch(error){next(error);}};/***Getallreportswithfilteringandpagination*/exportconstgetAllReports=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{constfilter=filterReportsSchema.parse({page:req.query.page?parseInt(req.query.pageasstring):1,limit:req.query.limit?parseInt(req.query.limitasstring):10,status:req.query.status,state:req.query.state,lga:req.query.lga,facilityType:req.query.facilityType,toiletCondition:req.query.toiletCondition,});constpaginatedData=awaitgetPaginatedReportsRepository(filter);res.status(200).json({success:true,message:'Reportsretrievedsuccessfully',data:paginatedData,});}catch(error){next(error);}};/***Getreportsbylocationformapvisualization*/exportconstgetReportsByLocation=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{const{state,lga}=getReportsByLocationSchema.parse(req.query);constreports=awaitgetReportsByLocationRepository(state,lga);res.status(200).json({success:true,message:'Locationreportsretrievedsuccessfully',data:reports,});}catch(error){next(error);}};/***Updatereportstatus(Adminonly)*/exportconstupdateReportStatus=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{const{id}=getReportSchema.parse(req.params);constupdateData=updateReportStatusSchema.parse({id,...req.body,});constexistingReport=awaitgetReportByIdRepository(id);if(!existingReport){res.status(404).json({success:false,message:'Reportnotfound',});return;}constupdatedReport=awaitupdateReportStatusRepository(updateData);if(existingReport.submitterEmail){conststatusMessage={APPROVED:'approvedandwillbedisplayedonourpublicmap',REJECTED:'reviewedbutcouldnotbeapprovedatthistime',PENDING:'underreview',};SendMail({to:existingReport.submitterEmail,subject:`ReportStatusUpdate-NationalToiletCampaign`,html:`<h2>ReportStatusUpdate</h2><p>Dear${existingReport.submitterName},</p><p>Yourtoiletreport(ID:${existingReport.id})hasbeen${statusMessage[updateData.status]}.</p>${updateData.adminNotes?`<p><strong>AdminNotes:</strong>${updateData.adminNotes}</p>`:''}<p>ThankyouforyourcontributiontoimprovingsanitationinNigeria!</p>`,});}res.status(200).json({success:true,message:'Reportstatusupdatedsuccessfully',data:updatedReport,});}catch(error){next(error);}};/***Deleteareport(Adminonly)*/exportconstdeleteReport=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{const{id}=getReportSchema.parse(req.params);constexistingReport=awaitgetReportByIdRepository(id);if(!existingReport){res.status(404).json({success:false,message:'Reportnotfound',});return;}awaitdeleteReportRepository(id);res.status(200).json({success:true,message:'Reportdeletedsuccessfully',});}catch(error){next(error);}};/***Getcampaignstatisticsandanalytics*/exportconstgetReportStats=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{logger.info({message:'checked',});conststats=awaitgetReportStatsRepository();res.status(200).json({success:true,message:'Reportstatisticsretrievedsuccessfully',data:stats,});}catch(error){next(error);}};/***Getrecentreportsfordashboard*/exportconstgetRecentReports=async(req:Request,res:Response,next:NextFunction):Promise<void>=>{try{constlimit=req.query.limit?parseInt(req.query.limitasstring):10;constreports=awaitgetRecentReportsRepository(limit);res.status(200).json({success:true,message:'Recentreportsretrievedsuccessfully',data:reports,});}catch(error){next(error);}};
//src/modules/report/report.route.ts
import{Router}from'express';import{createReport,getReport,getAllReports,getReportsByLocation,updateReportStatus,deleteReport,getReportStats,getRecentReports,}from'./report.controller';import{authenticateAdmin}from'../../middlewares/auth.middleware';constreportRouter=Router();reportRouter.post('/',createReport);reportRouter.get('/location',getReportsByLocation);reportRouter.get('/stats',getReportStats);reportRouter.get('/recent',getRecentReports);reportRouter.get('/',authenticateAdmin,getAllReports);reportRouter.get('/:id',authenticateAdmin,getReport);reportRouter.patch('/:id/status',authenticateAdmin,updateReportStatus);reportRouter.delete('/:id',authenticateAdmin,deleteReport);exportdefaultreportRouter;
//src/modules/report/report.schema.ts
import{z}from'zod';exportconstReportStatusEnum=z.enum(['PENDING','APPROVED','REJECTED']);exportconstToiletConditionEnum=z.enum(['EXCELLENT','GOOD','FAIR','POOR','VERY_POOR',]);exportconstFacilityTypeEnum=z.enum(['PUBLIC','PRIVATE','SCHOOL','HOSPITAL','MARKET','OFFICE','RESIDENTIAL','OTHER',]);exportconstcreateReportSchema=z.object({submitterName:z.string().min(2,'Submitternameisrequired'),submitterEmail:z.string().email('Invalidemailaddress').optional(),submitterPhone:z.string().min(10,'Validphonenumberisrequired').optional(),state:z.string().min(2,'Stateisrequired'),lga:z.string().min(2,'LocalGovernmentAreaisrequired'),ward:z.string().optional(),specificAddress:z.string().min(5,'Specificaddressisrequired'),coordinates:z.string().optional(),images:z.array(z.string().url('InvalidimageURL')).min(1,'Atleastoneimageisrequired'),description:z.string().optional(),toiletCondition:ToiletConditionEnum,facilityType:FacilityTypeEnum,});exportconstupdateReportStatusSchema=z.object({id:z.string(),status:ReportStatusEnum,adminNotes:z.string().optional(),reviewedBy:z.string().optional(),});exportconstgetReportSchema=z.object({id:z.string(),});exportconstfilterReportsSchema=z.object({page:z.number().int().positive().default(1),limit:z.number().int().positive().max(100).default(10),status:ReportStatusEnum.optional(),state:z.string().optional(),lga:z.string().optional(),facilityType:FacilityTypeEnum.optional(),toiletCondition:ToiletConditionEnum.optional(),});exportconstgetReportsByLocationSchema=z.object({state:z.string(),lga:z.string().optional(),});exporttypeReportStatus=z.infer<typeofReportStatusEnum>;exporttypeToiletCondition=z.infer<typeofToiletConditionEnum>;exporttypeFacilityType=z.infer<typeofFacilityTypeEnum>;exporttypeCreateReport=z.infer<typeofcreateReportSchema>;exporttypeUpdateReportStatus=z.infer<typeofupdateReportStatusSchema>;exporttypeFilterReports=z.infer<typeoffilterReportsSchema>;
//src/modules/report/report.tspec.ts
import{Tspec}from'tspec';/**@tspec-descriptionToiletconditionreport*/exportinterfaceReport{/**Uniqueidentifierforthereport*/id:string;/**Nameofthepersonsubmittingthereport*/submitterName:string;/**Emailofthesubmitter(optional)*/submitterEmail?:string;/**Phonenumberofthesubmitter(optional)*/submitterPhone?:string;/**Nigerianstatewheretoiletislocated*/state:string;/**LocalGovernmentArea*/lga:string;/**Ward(optional)*/ward?:string;/**Specificaddressofthetoiletfacility*/specificAddress:string;/**GPScoordinates(optional)*/coordinates?:string;/**ArrayofimageURLs*/images:string[];/**Additionaldescription(optional)*/description?:string;/**Conditionofthetoilet*/toiletCondition:'EXCELLENT'|'GOOD'|'FAIR'|'POOR'|'VERY_POOR';/**Typeoffacility*/facilityType:|'PUBLIC'|'PRIVATE'|'SCHOOL'|'HOSPITAL'|'MARKET'|'OFFICE'|'RESIDENTIAL'|'OTHER';/**Adminreviewstatus*/status:'PENDING'|'APPROVED'|'REJECTED';/**Adminnotes(adminonly)*/adminNotes?:string;/**Whenreportwasreviewed*/reviewedAt?:string;/**IDofadminwhoreviewed*/reviewedBy?:string;/**Reportcreationtimestamp*/createdAt:string;/**Reportupdatetimestamp*/updatedAt:string;}/**@tspec-descriptionRequesttocreateanewreport*/exportinterfaceCreateReportRequest{/**Nameofthepersonsubmittingthereport*/submitterName:string;/**Emailofthesubmitter(optional)*/submitterEmail?:string;/**Phonenumberofthesubmitter(optional)*/submitterPhone?:string;/**Nigerianstatewheretoiletislocated*/state:string;/**LocalGovernmentArea*/lga:string;/**Ward(optional)*/ward?:string;/**Specificaddressofthetoiletfacility*/specificAddress:string;/**GPScoordinates(optional)*/coordinates?:string;/**ArrayofimageURLs*/images:string[];/**Additionaldescription(optional)*/description?:string;/**Conditionofthetoilet*/toiletCondition:'EXCELLENT'|'GOOD'|'FAIR'|'POOR'|'VERY_POOR';/**Typeoffacility*/facilityType:|'PUBLIC'|'PRIVATE'|'SCHOOL'|'HOSPITAL'|'MARKET'|'OFFICE'|'RESIDENTIAL'|'OTHER';}/**@tspec-descriptionRequesttoupdatereportstatus*/exportinterfaceUpdateReportStatusRequest{/**Reportreviewstatus*/status:'PENDING'|'APPROVED'|'REJECTED';/**Adminnotes(optional)*/adminNotes?:string;/**IDofadminreviewing*/reviewedBy?:string;}/**@tspec-descriptionCampaignstatistics*/exportinterfaceReportStats{/**Totalnumberofreports*/totalReports:number;/**Numberofapprovedreports*/approvedReports:number;/**Numberofpendingreports*/pendingReports:number;/**Numberofrejectedreports*/rejectedReports:number;/**Reportsgroupedbystate*/reportsByState:Array<{state:string;_count:{id:number;};}>;/**Reportsgroupedbycondition*/reportsByCondition:Array<{toiletCondition:string;_count:{id:number;};}>;}/**@tspec-descriptionPaginatedreportsresponse*/exportinterfacePaginatedReportsResponse{/**Arrayofreportobjects*/reports:Report[];/**Totalnumberofreports*/total:number;/**Currentpagenumber*/page:number;/**Numberofitemsperpage*/limit:number;/**Totalnumberofpages*/totalPages:number;}/**@tspec-descriptionLocation-basedreportformapvisualization*/exportinterfaceLocationReport{/**ReportID*/id:string;/**Statename*/state:string;/**LGAname*/lga:string;/**Wardname*/ward?:string;/**Specificaddress*/specificAddress:string;/**GPScoordinates*/coordinates?:string;/**Toiletcondition*/toiletCondition:'EXCELLENT'|'GOOD'|'FAIR'|'POOR'|'VERY_POOR';/**Facilitytype*/facilityType:|'PUBLIC'|'PRIVATE'|'SCHOOL'|'HOSPITAL'|'MARKET'|'OFFICE'|'RESIDENTIAL'|'OTHER';/**ImageURLs*/images:string[];/**Creationtimestamp*/createdAt:string;}/**@tspec-descriptionRecentreportforpublicdisplay*/exportinterfaceRecentReport{/**ReportID*/id:string;/**Submittername*/submitterName:string;/**Statename*/state:string;/**LGAname*/lga:string;/**Toiletcondition*/toiletCondition:'EXCELLENT'|'GOOD'|'FAIR'|'POOR'|'VERY_POOR';/**Facilitytype*/facilityType:|'PUBLIC'|'PRIVATE'|'SCHOOL'|'HOSPITAL'|'MARKET'|'OFFICE'|'RESIDENTIAL'|'OTHER';/**Creationtimestamp*/createdAt:string;}/**@tspec-descriptionStandardsuccessresponse*/exportinterfaceSuccessResponse<T=any>{success:true;message:string;data?:T;}/**@tspec-descriptionStandarderrorresponse*/exportinterfaceErrorResponse{success:false;message:string;errors?:any[];}exporttypeReportApiSpec=Tspec.DefineApiSpec<{tags:['Reports'];security:'bearerAuth';paths:{/**Submitanewtoiletreport*/'/api/v1/report':{post:{summary:'Submitanewtoiletreport';description:'Allowscitizenstosubmittoiletconditionreportswithphotosandlocationdata';tags:['Reports'];body:CreateReportRequest;responses:{/**Reportsubmittedsuccessfully*/201:SuccessResponse<Report>;/**Invalidinputdata*/400:ErrorResponse;};};get:{summary:'Getallreports(Adminonly)';description:'Retrieveallreportswithfilteringandpaginationforadmindashboard';tags:['Reports'];query:{/**Pagenumber*/page?:number;/**Numberofitemsperpage*/limit?:number;/**Filterbystatus*/status?:'PENDING'|'APPROVED'|'REJECTED';/**Filterbystate*/state?:string;/**FilterbyLGA*/lga?:string;/**Filterbyfacilitytype*/facilityType?:|'PUBLIC'|'PRIVATE'|'SCHOOL'|'HOSPITAL'|'MARKET'|'OFFICE'|'RESIDENTIAL'|'OTHER';/**Filterbytoiletcondition*/toiletCondition?:|'EXCELLENT'|'GOOD'|'FAIR'|'POOR'|'VERY_POOR';};responses:{/**Reportsretrievedsuccessfully*/200:SuccessResponse<PaginatedReportsResponse>;/**Unauthorized*/401:ErrorResponse;/**Adminaccessrequired*/403:ErrorResponse;};};};/**Getaspecificreport*/'/api/v1/report/:id':{get:{summary:'Getaspecificreport(Adminonly)';description:'RetrieveaspecificreportbyID';tags:['Reports'];path:{/**ReportID*/id:string;};responses:{/**Reportretrievedsuccessfully*/200:SuccessResponse<Report>;/**Unauthorized*/401:ErrorResponse;/**Reportnotfound*/404:ErrorResponse;};};delete:{summary:'Deleteareport(Adminonly)';description:'Deleteaspecificreport';tags:['Reports'];path:{/**ReportID*/id:string;};responses:{/**Reportdeletedsuccessfully*/200:SuccessResponse;/**Unauthorized*/401:ErrorResponse;/**Reportnotfound*/404:ErrorResponse;};};};/**Updatereportstatus*/'/api/v1/report/:id/status':{patch:{summary:'Updatereportstatus(Adminonly)';description:'Approve,reject,orchangestatusofareport';tags:['Reports'];path:{/**ReportID*/id:string;};body:UpdateReportStatusRequest;responses:{/**Reportstatusupdatedsuccessfully*/200:SuccessResponse<Report>;/**Unauthorized*/401:ErrorResponse;/**Reportnotfound*/404:ErrorResponse;};};};/**Getreportsbylocation*/'/api/v1/report/location':{get:{summary:'Getreportsbylocation(Public)';description:'Getapprovedreportsformapvisualization';tags:['Reports'];query:{/**Statename(required)*/state:string;/**LGAname(optional)*/lga?:string;};responses:{/**Locationreportsretrievedsuccessfully*/200:SuccessResponse<LocationReport[]>;};};};/**Getcampaignstatistics*/'/api/v1/report/stats':{get:{summary:'Getcampaignstatistics(Public)';description:'Getpublicstatisticsforthecampaigndashboard';tags:['Reports'];responses:{/**Statisticsretrievedsuccessfully*/200:SuccessResponse<ReportStats>;};};};/**Getrecentapprovedreports*/'/api/v1/report/recent':{get:{summary:'Getrecentapprovedreports(Public)';description:'Getrecentapprovedreportsforpublicdisplay';tags:['Reports'];query:{/**Numberofrecentreportstoreturn*/limit?:number;};responses:{/**Recentreportsretrievedsuccessfully*/200:SuccessResponse<RecentReport[]>;};};};};}>;
===0-files===
